# 実装計画

## タスク形式

### メジャータスクのみ
- [ ] {{番号}}. {{タスク概要}}{{並列マーカー}}
  - {{補足}} *(必要な場合のみ補足を記載)*
  - _Requirements: {{Requirement IDs}}_

### メジャー + サブタスク構造
- [ ] {{メジャー番号}}. {{メジャータスク概要}}
- [ ] {{メジャー番号}}.{{サブ番号}} {{サブタスク概要}}{{並列マーカー}}
  - {{補足1}}
  - {{補足2}}
  - _Requirements: {{Requirement IDs}}_ *(IDのみを記載)*

> **並列マーカー**: 並列実行可能なタスクには ` (P)` を付与する。
>
> **任意のテスト**: 受け入れ条件に紐づく任意テストは `- [ ]*` とし、補足で対象要件を説明する。

---

## 実装タスク

- [ ] 0. 状態モデル定義
- [ ] 0.1 状態一覧と遷移ルールの定義 (P)
  - 投票（受付中 / 締切）
  - 日程（未確定 / 確定）
  - 出席（未確定 / 実出席）
  - 会計（未確定 / 確定）
  - 支払（未申請 / 申請中 / 承認済み）
  - _Requirements: R3,R5,R7,R8,R10,R11,R15_

- [ ] 1. ドメイン設計とデータモデル
- [ ] 1.1 エンティティと関連の設計 (P)
  - Event / CandidateDate / Vote / Attendance / Payment の関連と制約を整理する
  - 参加者ログイン不要の前提で識別子と表示名の扱いを定義する
  - _Requirements: R1,R2,R16,R18_
- [ ] 1.2 スキーマとマイグレーション設計
  - イベントURLの推測困難性を担保できるキー設計を含める
  - 投票締切・会計確定・支払ステータスの遷移を保持できる構造にする
  - _Requirements: R4,R5,R10,R11,R15_
- [ ] 1.3 参加者識別と匿名性の設計 (P)
  - Vote / Attendance / Payment における識別子の扱いを統一する
  - 表示名と内部IDを分離する
  - 同姓同名・編集可能仕様を前提とした設計にする
  - _Requirements: R5,R8,R11,R18_

- [ ] 2. 認証と幹事権限
- [ ] 2.1 幹事ログイン/登録（メール＋パスワード、Google） (P)
  - セッション管理とパスワード再設定の基本動線を用意する
  - _Requirements: R2_
- [ ] 2.2 イベント編集権限（作成ユーザー）
  - ログインユーザーの一致で編集可否を判定する
  - _Requirements: R2_

- [ ] 3. イベント作成と共有
- [ ] 3.1 作成フォームと保存 (P)
  - イベント名/候補日/メモの登録を実装する
  - _Requirements: R4_
- [ ] 3.2 参加者用URLの生成と表示
  - URL共有動線と表示ページの導線を整える
  - _Requirements: R4_

- [ ] 4. 日程投票フロー
- [ ] 4.1 投票入力・更新・削除 (P)
  - 名前、候補日ごとの◯/△/✕、コメントを保存できる
  - _Requirements: R5_
- [ ] 4.2 一覧表示とインライン編集UI
  - 名前クリックで同一ページ下部に編集フォームを表示する
  - _Requirements: R5_
- [ ] 4.3 投票締切の制御
  - 締切時は新規/編集/削除を禁止し、解除を可能にする
  - _Requirements: R5,R15_
- [ ] 4.4 投票通知メール送信
  - 新規投票のみ通知し、編集/削除では送らない
  - _Requirements: R6,R17_

- [ ] 5. 日程確定と参加者リスト
- [ ] 5.1 確定日選択と反映 (P)
  - 候補日から1つを確定できるUI/APIを実装する
  - _Requirements: R7_
- [ ] 5.2 参加者リストの自動生成
  - ◯/△を参加者、✕を除外するルールで生成する
  - _Requirements: R7_

- [ ] 6. 当日出席管理と一覧
- [ ] 6.1 出席チェックの更新 (P)
  - 幹事がチェックした人のみ実出席者にする
  - _Requirements: R8_
- [ ] 6.2 飛び入り参加者の追加
  - 参加者リスト外の追加を可能にする
  - _Requirements: R8_
- [ ] 6.3 出席一覧の公開表示
  - 名前/出席/支払いの列を持つ一覧を表示する
  - _Requirements: R9_

- [ ] 7. 会計管理
- [ ] 7.1 合計金額と均等割り計算 (P)
  - 端数切り上げで1人あたり金額を算出する
  - _Requirements: R10_
- [ ] 7.2 個別金額の調整
  - 参加者ごとの支払金額を上書きできる
  - _Requirements: R10_
- [ ] 7.3 会計確定とロック
  - 会計確定前は支払申請を不可にする
  - _Requirements: R10,R15_

- [ ] 8. 支払申請・承認
- [ ] 8.1 参加者の支払申請 (P)
  - 実出席者のみ申請でき、支払方法を必須入力にする
  - _Requirements: R11_
- [ ] 8.2 ステータス遷移と操作制御
  - 参加者は申請中の変更/取消が可能、承認済みは不可にする
  - _Requirements: R11,R15_
- [ ] 8.3 幹事の承認/差し戻し
  - 申請中→承認済み、差し戻しを可能にする
  - _Requirements: R11_
- [ ] 8.4 支払通知メール送信
  - 未申請→申請中のタイミングで通知する
  - _Requirements: R12,R17_
- [ ] 8.5 支払状況一覧
  - 未申請者が分かるUIを提供する
  - _Requirements: R13_

- [ ] 9. 権限・非機能・制約
- [ ] 9.1 権限ルールの統合検証 (P)
  - 参加者/幹事の操作可能範囲を全操作で確認する
  - _Requirements: R14,R15_
- [ ] 9.2 レスポンシブと匿名アクセスの担保
  - PC/スマホの画面で主要フローを確認する
  - _Requirements: R17_
- [ ] 9.3 やらないことのガード
  - 決済機能・メッセージ機能の不実装を明示する
  - _Requirements: R18_
- [ ] 9.4 UI表示条件の横断確認
  - 実出席者のみ表示される操作の整理
  - 幹事のみ表示される情報の整理
  - 状態別（未確定/確定/締切）の表示差分確認
  - _Requirements: R9,R10,R11,R14,R15_
- [ ] 9.5 通知処理の前提整理 (P)
  - メール送信は非同期処理として扱う
  - 送信失敗時も主要フローはブロックしない
  - _Requirements: R6,R12,R17_

- [ ]* 10. 受け入れ基準のテスト整備
  - 日程投票〜確定、出席管理、会計、支払申請/承認の主要フローを検証する
  - _Requirements: R3,R5,R7,R8,R10,R11,R12_
